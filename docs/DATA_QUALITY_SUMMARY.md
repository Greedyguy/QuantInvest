# 📊 한국 시장 데이터 품질 점검 요약

**점검 일시**: 2025-11-17  
**백테스트 신뢰성**: ⚠️  주의 필요

---

## 🎯 핵심 발견사항

### 1️⃣ **Universe 커버리지: 85.6%** (✅ 양호)
```
전체 한국 시장: 2,879개 종목
캐시된 종목: 2,465개
누락: 414개 (14.4%)

KOSPI: 958개
KOSDAQ: 1,805개
KONEX: 116개
```

**평가**: 대부분의 주요 종목은 커버됨. 누락 종목은 신규상장, ETF, 관리종목으로 추정.

---

### 2️⃣ **데이터 신선도: 11일 지연** (⚠️  주의)
```
최신 데이터: 2025-11-06
오늘 날짜: 2025-11-17
지연: 11일
```

**영향**:
- 최근 1~2주 시장 움직임 미반영
- 백테스트 결과가 현재 시장과 괴리될 수 있음
- **권장**: 데이터 업데이트 필요 (`python reports.py --refresh`)

---

### 3️⃣ **시가총액 데이터: 없음** (❌ 심각)
```
시가총액 컬럼: 0/2,465 종목
```

**영향**:
- ❌ KSMS 전략의 시가총액 필터링 작동 안 함
  - `min_market_cap=300억`, `max_market_cap=3000억` 필터 **무력화**
- ❌ KQM 전략의 대형주/소형주 구분 불가
- ⚠️  거래대금 기준으로만 필터링 → **부정확**

**해결책**: `data_loader.py`에 pykrx `get_market_cap()` 추가 필요

---

### 4️⃣ **데이터 중복 문제** (⚠️  비효율)
```
예시: 000020 종목
- 000020_20190101_20251107.parquet
- 000020_20190101_20251110.parquet
- 000020_20190101_20251111.parquet
- 000020_20190101_20251112.parquet
- 000020_20190101_20251113.parquet
```

**영향**:
- 디스크 공간 낭비 (1.5GB → 실제 필요량의 5배 추정)
- 파일 관리 복잡도 증가

**해결책**: 증분 업데이트 로직 개선 + 구버전 파일 자동 삭제

---

## 🔍 세부 분석

### 데이터 완전성
```
✅ OHLCV: 정상
✅ Volume: 정상
✅ 기술적 지표: 계산됨
   - ma20, ma60, rsi14, 등
✅ 시계열 연속성: 갭 없음
❌ 펀더멘털 데이터: 없음
   - market_cap, ROE, PER, PBR
```

### 파일 통계
```
총 파일: 12,311개
평균 크기: 0.13 MB
총 용량: 1,569 MB (~1.5GB)
평균 데이터 일수: 1,436일 (~5.7년)
```

---

## ⚠️  백테스트 신뢰성에 미치는 영향

### 현재 상황에서의 문제점

#### 1. KSMS 전략 (소형주 스윙)
```python
# strategy_ksms.py 설정
min_market_cap = 300억
max_market_cap = 3,000억
```

**현실**:
- 시가총액 필터 **작동 안 함**
- 거래대금만으로 필터링 → **부정확**
- 예: 삼성전자 같은 대형주도 선택될 수 있음

**해결 전까지**:
- ⚠️  KSMS 백테스트 결과 **신뢰 불가**
- 실제 매매 시 **수동으로 시가총액 확인 필수**

#### 2. KQM 전략 (Quality Momentum)
```python
# 팩터 기반 선택
ROE, PER, PBR 기반 가치 평가
```

**현실**:
- 모든 펀더멘털 지표 없음
- Proxy 지표 사용 중 (가격 기반 추정)
- **부정확한 종목 선택 가능성**

**해결 전까지**:
- ⚠️  팩터 스코어 부정확
- 백테스트 결과 **실제보다 낙관적일 수 있음**

#### 3. 데이터 신선도
```
최신 데이터: 2025-11-06
누락 기간: 11월 7일 ~ 11월 17일 (11일)
```

**영향**:
- 최근 시장 급변동 미반영
- 11월 중순 이후 전략 성능 **예측 불가**

---

## 💡 즉시 조치 사항

### 🔥 긴급 (오늘 내)
1. ✅ **`cache_manager.py` 버그 수정** (완료)
2. ⬜ **데이터 업데이트**
   ```bash
   python reports.py --refresh
   ```
   → 최신 11월 17일까지 데이터 수집

### ⚠️  중요 (이번 주 내)
3. ⬜ **시가총액 데이터 추가**
   - `data_loader.py` 수정
   - 전체 종목 재수집 필요
   
4. ⬜ **데이터 품질 재검증**
   ```bash
   python data_quality_check.py
   ```
   → 종합 점수 80+ 목표

### 📋 개선 (여유 있을 때)
5. ⬜ 중복 파일 정리
6. ⬜ 누락 414개 종목 수집
7. ⬜ 자동 데이터 업데이트 스케줄러

---

## 📈 개선 로드맵

```
현재 (46.4점)
├─ Universe: 85.6점 ✅
├─ 완전성: 0점 → 80점 (버그 수정 완료)
├─ 신선도: 40점 (11일 지연)
└─ 시가총액: 0점

1주 후 목표 (85점)
├─ Universe: 90점 (누락 종목 추가)
├─ 완전성: 95점 (시가총액 추가)
├─ 신선도: 100점 (자동 업데이트)
└─ 시가총액: 100점
```

---

## 🚀 백테스트 실행 전 체크리스트

### 실행 전 필수 확인사항
- [ ] 데이터 신선도 7일 이내
- [ ] 시가총액 데이터 존재 (KSMS 사용 시)
- [ ] Universe 커버리지 85% 이상
- [ ] 데이터 로드 오류 없음

### 현재 상태
```
- [x] 데이터 신선도: ❌ 11일 지연
- [x] 시가총액: ❌ 없음
- [x] Universe: ✅ 85.6%
- [x] 로드 오류: ✅ 해결됨
```

**결론**: 
⚠️  **KQM 전략은 실행 가능** (시가총액 미사용)  
❌ **KSMS 전략은 데이터 보완 후 실행 권장**

---

**다음 액션**: `python reports.py --refresh` 실행으로 데이터 업데이트

